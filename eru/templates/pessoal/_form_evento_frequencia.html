{% load i18n %}
{% load ui_components %}
<div class="card-body tab-content">
    <h5 class="card-title mb-3">{% translate 'Cadastro'|escapejs %}: <b class="text-purple">{% translate 'Evento Frequência'|escapejs %}</b></h5>
    <div class="tab-pane fade show active" id="base" role="tabpanel">
        <div class="row">
            <div class="col col-lg-5">
                <div class="row g-1">
                    <div class="form-floating mb-lg-1 col-lg">
                        {{ form.nome }}
                        {{ form.nome.i18n_label }}
                    </div>
                    <div class="form-floating mb-1 col-lg-auto">
                        {{ form.prioridade }}
                        {{ form.prioridade.i18n_label }}
                    </div>
                </div>
                <div class="row g-1">
                    <div class="form-floating mb-1 col">
                        {{ form.categoria }}
                        {{ form.categoria.i18n_label }}
                    </div>
                </div>
                <div class="row">
                    <div class="col mt-2">
                        {% btn_tag 'submit' %}
                    </div>
                </div>
            </div>
            <div class="col-lg mt-3 mt-lg-0">
                <div class="form-check form-switch">
                    {{form.contabiliza_horas}}
                    {{form.contabiliza_horas.i18n_label}}
                </div>
                <div class="form-check form-switch">
                    {{form.remunerado}}
                    {{form.remunerado.i18n_label}}
                </div>
                <div class="form-check form-switch">
                    {{form.dia_inteiro}}
                    {{form.dia_inteiro.i18n_label}}
                </div>
                <hr>
                <div class="row">
                    <div class="col-auto">
                        <div class="input-group">
                            <div id="wrapper_picker" class="color-container is-empty rounded-end-0">
                                <input type="color" id="color_picker" 
                                class="form-control form-control-color rounded-end-0" 
                                value="{{ form.cor.value|default:'#ffffff' }}">
                            </div>
                            <button type="button" class="btn btn-secondary-matte border-0" onclick="clearColor()"><i class="bi bi-slash-lg"></i></button>
                        </div>
                        {{ form.cor }}
                        
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    (function injectColorPickerCSS() {
        const styleId = 'color-picker-custom-style';
        if (!document.getElementById(styleId)) {
            const style = document.createElement('style');
            style.id = styleId;
            style.textContent = `
                .color-container { position: relative; display: inline-flex; }
                .form-control-color { width: 3rem; border-top-right-radius: 0 !important; border-bottom-right-radius: 0 !important; }
                .color-container.is-empty::before {
                    content: ""; position: absolute; top: 6px; left: 6px; right: 6px; bottom: 6px;
                    z-index: 2; pointer-events: none; border-radius: 2px;
                    background-color: var(--bs-body-bg);
                    background-image: 
                        linear-gradient(45deg, var(--bs-secondary-bg) 25%, transparent 25%), 
                        linear-gradient(-45deg, var(--bs-secondary-bg) 25%, transparent 25%), 
                        linear-gradient(45deg, transparent 75%, var(--bs-secondary-bg) 75%), 
                        linear-gradient(-45deg, transparent 75%, var(--bs-secondary-bg) 75%);
                    background-size: 8px 8px; background-position: 0 0, 0 4px, 4px 4px, 4px 0;
                }
                /* Garante que a cor interna suma no modo vazio */
                .color-container.is-empty input[type="color"]::-webkit-color-swatch { border: none; opacity: 0; }
                .color-container.is-empty input[type="color"]::-moz-color-swatch { border: none; opacity: 0; }
            `;
            document.head.appendChild(style);
        }
    })();

    // Lógica do componente
    const color_picker = document.getElementById('color_picker');
    const cor_input = document.getElementById('id_cor');
    const wrapper = document.getElementById('wrapper_picker');

    // Inicialização: Se já vier com cor do banco, remove o 'is-empty'
    if (cor_input.value) {
        wrapper.classList.remove('is-empty');
        color_picker.value = cor_input.value;
    }

    color_picker.oninput = () => {
        cor_input.value = color_picker.value;
        wrapper.classList.remove('is-empty');
    };

    function clearColor() {
        cor_input.value = '';
        wrapper.classList.add('is-empty');
        color_picker.value = '#ffffff';
    }
</script>
